<app-login></app-login>

<div class="task-manager">
  <header class="header">
    <h1>üìã –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á</h1>
    <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º –¥–µ–ª</p>
  </header>

  @if (errorMessage) {
    <div class="error-message">
      {{errorMessage}}
      <button class="close-btn" (click)="errorMessage = ''">
        √ó
      </button>
    </div>
  }

  <div class="create-form">
    <input
      type="text"
      [(ngModel)]="newTaskTitle"
      placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?"
      (keyup.enter)="createTask()"
      class="task-input"
    />
    <button
      (click)="createTask()"
      class="btn btn-primary"
      [disabled]="!newTaskTitle.trim()"
    >
      ‚ûï –î–æ–±–∞–≤–∏—Ç—å
    </button>
  </div>

  @if(loading) {
    <div class="loading">
      –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...
    </div>
  }

  @if(!loading) {

    @if(tasks.length === 0) {
      <div class="empty-state">
        üì≠ –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É!
      </div>
    }

    @if(tasks.length > 0) {
      <div class="tasks-container">
        <div class="stats">
          <span class="stat">
            –í—Å–µ–≥–æ:
            <strong>
              {{totalTasks}}
            </strong>
          </span>
          <span class="stat">
            –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
            <strong>
              {{completedTasks}}
            </strong>
          </span>
          <span class="stat">
            –û—Å—Ç–∞–ª–æ—Å—å:
            <strong>
              {{pendingTasks}}
            </strong>
          </span>
        </div>

        <ul class="task-list">

          @for (task of tasks; track task.id) {
            <li
              class="task-item"
              [ngClass]="getTaskClasses(task.completed)"
            >
              <input
                type="checkbox"
                [checked]="task.completed"
                (change)="toggleTask(task.id)"
                class="task-checkbox"
              />

              <div class="task-content">

                @if (editingTaskId === task.id) {
                  <div class="edit-mode">
                    <input
                      type="text"
                      [(ngModel)]="editTaskTitle"
                      (keyup.enter)="saveEdit(task.id)"
                      class="edit-input"
                    />
                    <div class="edit-actions">
                      <button (click)="saveEdit(task.id)" class="btn btn-save">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                      </button>
                      <button (click)="cancelEdit()" class="btn btn-cancel">
                        ‚ùå –û—Ç–º–µ–Ω–∞
                      </button>
                    </div>
                  </div>
                } @else {
                  <div class="view-mode">
                    <span class="task-title">
                      {{task.title}}
                    </span>
                    <span class="task-date">
                      üìÖ {{formatDate(task.createdAt)}}
                    </span>
                  </div>
                }
              </div>

              @if (editingTaskId !== task.id) {
                <div class="task-actions">
                  <button
                    (click)="startEdit(task)"
                    class="btn btn-edit"
                    title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    (click)="deleteTask(task.id)"
                    class="btn btn-delete"
                    title="–£–¥–∞–ª–∏—Ç—å"
                  >
                    üóë
                  </button>
                </div>
              }
            </li>
          } @empty {
            <li class="empty-state">
              üìù –ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç
            </li>
          }
        </ul>

        <div class="refresh-section">
          <button (click)="loadTasks()" class="btn btn-refresh">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
          </button>
        </div>
      </div>
    }
  }

  <footer class="footer">
    <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API –Ω–∞ Express + Prisma + PostgreSQL</p>
  </footer>
</div>
